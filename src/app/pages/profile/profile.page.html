 <ion-content>
  <ion-grid class="profile-container">
    <!-- Header con avatar -->
    <ion-row class="header-section">
      <ion-col size="12">
        <ion-card>
          <ion-card-content>
            <ion-row class="profile-header" align-items-center>
              <ion-col class="avatar-section ion-text-center" size="12">
                <ion-text class="ion-text-center" style="display:block; font-weight:600;">{{ profile()?.full_name || 'Usuario' }}</ion-text>
                <ion-avatar class="profile-avatar" style="margin:8px auto;">
                  @if (profile()?.avatar_url) {
                    <ion-img [src]="profile()!.avatar_url" alt="Avatar"></ion-img>
                  } @else {
                    <ion-icon name="person" size="large"></ion-icon>
                  }
                </ion-avatar>
                <app-avatar-uploader
                  (fileSelected)="selectedFile = $event"
                  (upload)="uploadAvatar()">
                </app-avatar-uploader>
                <ion-text color="medium" class="ion-text-center" style="display:block; margin-top:6px;">{{ profile()?.email }}</ion-text>
                <ion-badge color="primary" style="margin-top:6px;">Activo</ion-badge>

                @if (!isEditing()) {
                  <ion-row class="ion-justify-content-center ion-margin-top">
                    <ion-col size="12" class="ion-text-center">
                      <ion-button size="small" color="primary" (click)="toggleEdit()">Editar info</ion-button>
                    </ion-col>
                  </ion-row>
                }
              </ion-col>
            </ion-row>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>

    <!-- Informaci칩n del perfil -->
    <ion-row class="info-section">
      <ion-col size="12">
      <ion-card>
        <ion-card-header>
          <ion-card-title>游늶 Informaci칩n Personal</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          @if (isLoading()) {
            <ion-row class="loading-container" justify-content-center>
              <ion-col size="12" class="ion-text-center">
                <ion-spinner name="crescent"></ion-spinner>
                <ion-text class="ion-margin-start">Cargando perfil...</ion-text>
              </ion-col>
            </ion-row>
          } @else {
            <ion-list class="info-form">
              <ion-item>
                <ion-label position="stacked">Nombre Completo</ion-label>
                @if (isEditing()) {
                  <ion-input [value]="fullName()" (ionInput)="fullName.set($event.detail.value!)" placeholder="Tu nombre completo"></ion-input>
                } @else {
                  <ion-text>{{ profile()?.full_name || 'No especificado' }}</ion-text>
                }
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Tel칠fono</ion-label>
                @if (isEditing()) {
                  <ion-input type="tel" [value]="phone()" (ionInput)="phone.set($event.detail.value!)" placeholder="Tu n칰mero de tel칠fono"></ion-input>
                } @else {
                  <ion-text>{{ profile()?.phone || 'No especificado' }}</ion-text>
                }
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Direcci칩n</ion-label>
                @if (isEditing()) {
                  <ion-textarea [value]="address()" (ionInput)="address.set($event.detail.value!)" placeholder="Tu direcci칩n en Buenaventura" rows="3"></ion-textarea>
                } @else {
                  <ion-text>{{ profile()?.address || 'No especificada' }}</ion-text>
                }
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Email</ion-label>
                <ion-text color="medium">{{ profile()?.email }}</ion-text>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Miembro desde</ion-label>
                <ion-text color="medium">
                  {{ getFechaCreacion() }}
                </ion-text>
              </ion-item>
            </ion-list>

            @if (isEditing()) {
              <ion-row class="form-actions">
                <ion-col size="12">
                  <ion-button fill="outline" color="medium" (click)="toggleEdit()">Cancelar</ion-button>
                  <ion-button color="primary" (click)="saveProfile()">Guardar</ion-button>
                </ion-col>
              </ion-row>
            }
          }
        </ion-card-content>
      </ion-card>
      </ion-col>
    </ion-row>

    <!-- Estad칤sticas -->
    <ion-row class="stats-section">
      <ion-col size="12">
      <ion-card>
        <ion-card-header>
          <ion-card-title>游늵 Estad칤sticas</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-row class="stats-grid">
            <ion-col class="stat-item" size="12">
              <ion-icon name="notifications" color="primary"></ion-icon>
              <div class="stat-info">
                <h3>{{ totalNotificaciones() }}</h3>
                <p>Notificaciones</p>
              </div>
            </ion-col>
            <ion-col class="stat-item" size="12">
              <ion-icon name="time" color="success"></ion-icon>
              <div class="stat-info">
                <h3>{{ getDiasActivo() }}</h3>
                <p>D칤as activo</p>
              </div>
            </ion-col>
            <ion-col class="stat-item" size="12">
              <ion-icon name="location" color="warning"></ion-icon>
              <div class="stat-info">
                <h3>{{ rutasSeguidas() }}</h3>
                <p>Rutas seguidas</p>
              </div>
            </ion-col>
          </ion-row>
        </ion-card-content>
      </ion-card>
      </ion-col>
    </ion-row>

    <!-- Acciones -->
    <ion-row class="actions-section">
      <ion-col size="12">
      <ion-card>
        <ion-card-content>
          <ion-row class="action-buttons" style="row-gap: 16px;">
            <ion-col size="12">
              <ion-button expand="block" fill="outline" color="primary" (click)="togglePwdForm()">
                {{ showPwdForm() ? 'Cancelar cambio de contrase침a' : 'Cambiar contrase침a' }}
              </ion-button>
            </ion-col>
            @if (showPwdForm()) {
            <ion-col size="12">
              <ion-label position="stacked">Nueva contrase침a</ion-label>
              <ion-input
                type="password"
                [value]="pwdNew()"
                (ionInput)="pwdNew.set($event.detail.value!)"
                placeholder="M칤nimo 6 caracteres">
              </ion-input>
            </ion-col>
            <ion-col size="12">
              <ion-label position="stacked">Confirmar contrase침a</ion-label>
              <ion-input
                type="password"
                [value]="pwdConfirm()"
                (ionInput)="pwdConfirm.set($event.detail.value!)"
                placeholder="Repite la contrase침a">
              </ion-input>
            </ion-col>
            <ion-col size="12">
              <ion-button expand="block" color="primary" (click)="changePassword()">
                Guardar contrase침a
              </ion-button>
            </ion-col>
            }
            <ion-col size="12">
              <ion-button 
                expand="block" 
                fill="outline" 
                color="medium"
                (click)="signOut()">
                <ion-icon name="log-out" slot="start"></ion-icon>
                Cerrar Sesi칩n
              </ion-button>
            </ion-col>
          </ion-row>
        </ion-card-content>
      </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
