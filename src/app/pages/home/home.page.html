<ion-content>
  <ion-grid class="home-container">
    <!-- Header con informaci√≥n de la ruta seleccionada -->
    <ion-row class="header-section">
      <ion-col size="12">
        <ion-card>
          <ion-card-content>
            <ion-row class="header-content" justify-content-between>
              <ion-col class="route-info">
                <br />
                @if (selectedRuta()) {
                <ion-text class="ion-margin-top"
                  >{{ selectedRuta()!.nombre }}</ion-text
                >
                <ion-text color="medium"
                  >{{ selectedRuta()!.descripcion }}</ion-text
                >
                } @else {
                <ion-text color="medium">Cargando rutas...</ion-text>
                }
              </ion-col>
              <ion-col class="logo-col" size="auto">
                <ion-img src="assets/icon/Logo.png" class="app-logo" alt="Logo"></ion-img>
              </ion-col>
            </ion-row>
            
            
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>

    <!-- Atajos por rol -->
    @if (role() === 'conductor') {
    <ion-row class="ion-padding-horizontal ion-padding-bottom">
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Hola, {{ displayName() }}</ion-card-title>
            <ion-card-subtitle>Accesos r√°pidos</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <ion-button
              expand="block"
              color="success"
              (click)="go('/conductor/rutas')"
            >
              <ion-icon slot="start" name="map-outline"></ion-icon>
              Rutas asignadas
            </ion-button>
            <ion-button
              expand="block"
              color="primary"
              (click)="go('/mapa')"
              class="ion-margin-top"
            >
              <ion-icon slot="start" name="map"></ion-icon>
              Ver mapa
            </ion-button>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
    } @if (role() === 'cliente') {
    <ion-row class="ion-padding-horizontal ion-padding-bottom">
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Carro en ruta</ion-card-title>
            <ion-card-subtitle>Seguimiento en tiempo real</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <ion-row class="ion-align-items-center">
              <ion-col>
                <ion-text color="medium"
                  >Veh√≠culos movi√©ndose: {{ movingVehiclesCount() }}</ion-text
                >
              </ion-col>
              <ion-col size="auto">
                <ion-button color="primary" (click)="go('/mapa')">
                  <ion-icon slot="start" name="map"></ion-icon>
                  Ver en mapa
                </ion-button>
              </ion-col>
            </ion-row>
          </ion-card-content>
        </ion-card>
        <ion-card>
          <ion-card-header>
            <ion-card-title>Mi zona</ion-card-title>
            <ion-card-subtitle>Rutas y horarios</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <ion-text color="medium"
              >Consulta el mapa para ver tu recorrido asignado.</ion-text
            >
            <ion-button
              fill="clear"
              size="small"
              (click)="go('/mapa')"
              class="ion-margin-top"
              >Abrir mapa</ion-button
            >
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
    } @if (role() === 'admin') {
    <ion-row class="ion-padding-horizontal ion-padding-bottom">
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Hola, {{ displayName() }}</ion-card-title>
            <ion-card-subtitle>Acceso al panel</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <ion-button expand="block" color="primary" (click)="go('/admin')">
              <ion-icon slot="start" name="settings"></ion-icon>
              Panel de administraci√≥n
            </ion-button>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
    }

    <!-- Bot√≥n para abrir la p√°gina del mapa de Buenaventura (oculto para cliente) -->
    @if (role() !== 'cliente') {
    <ion-row class="open-map-action ion-padding-horizontal ion-padding-bottom">
      <ion-col size="12">
        <ion-button expand="block" color="primary" (click)="goToMapa()">
          <ion-icon slot="start" name="map-outline"></ion-icon>
          Ver Mapa de Buenaventura
        </ion-button>
        
      </ion-col>
    </ion-row>
    }

   

    <!-- Lista de veh√≠culos -->
    <ion-row class="vehicles-section">
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-title>üöõ Estado de Veh√≠culos</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            @if (isLoading()) {
            <ion-row class="loading-container" justify-content-center>
              <ion-col size="12" class="ion-text-center">
                <ion-spinner name="crescent"></ion-spinner>
                <ion-text class="ion-margin-start"
                  >Cargando veh√≠culos...</ion-text
                >
              </ion-col>
            </ion-row>
            } @else {

              @for (vehiculo of vehiclesForDisplay(); track vehiculo.id) {
              <ion-card class="vehicle-card">
                <ion-item lines="none" detail="false">
                  <ion-avatar slot="start">
                    <ion-icon name="car" color="primary"></ion-icon>
                  </ion-avatar>
                  <ion-label class="veh-info">
                    <ion-text class="veh-placa">{{ vehiculo.placa }}</ion-text>
                    <ion-text class="veh-modelo">{{ vehiculo.modelo }}</ion-text>
                    <ion-text class="veh-marca">{{ vehiculo.marca || 'Sin marca' }}</ion-text>
                  </ion-label>
                  <ion-label slot="end" class="veh-meta">
                    @if (getUbicacionVehiculo(vehiculo.id)) {
                      <ion-text class="meta-row">
                        <ion-text class="speed">üöõ {{ getUbicacionVehiculo(vehiculo.id)!.velocidad }} km/h</ion-text>
                      </ion-text>
                      <ion-badge [color]="estadoVehiculo(vehiculo).color">{{ estadoVehiculo(vehiculo).text }}</ion-badge>
                    } @else {
                      <ion-badge color="danger">Sin ubicaci√≥n</ion-badge>
                    }
                  </ion-label>
                </ion-item>
              </ion-card>
              } @empty {
              <ion-row class="empty-state" justify-content-center>
                <ion-col size="12" class="ion-text-center">
                  <ion-icon
                    name="car-outline"
                    size="large"
                    color="medium"
                  ></ion-icon>
                  <ion-text>No hay veh√≠culos activos en esta ruta</ion-text>
                </ion-col>
              </ion-row>
              }
              }
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>

    <!-- Selector de rutas (oculto para conductor) -->
    @if (role() !== 'conductor') {
    <ion-row class="routes-section">
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-title>üó∫Ô∏è Rutas Disponibles</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-row class="routes-list">
              @for (ruta of topRutas(); track ruta.id) {
              <ion-chip
                [color]="selectedRuta()?.id === ruta.id ? 'primary' : 'medium'"
                (click)="selectRuta(ruta)"
                class="route-chip"
              >
                <ion-icon name="location" slot="start"></ion-icon>
                <ion-label>{{ ruta.nombre }}</ion-label>
              </ion-chip>
              }
            </ion-row>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
    }
  </ion-grid>
</ion-content>
