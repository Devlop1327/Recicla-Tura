<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Gestión de Vehículos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <ion-grid class="ion-padding">
    <!-- Formulario de vehículo -->
    <ion-row>
      <ion-col size="12" size-md="8" offset-md="2" size-lg="6" offset-lg="3">
        <ion-card>
          <ion-card-header>
            <ion-card-title>
              <ion-icon name="car-outline" class="ion-margin-end"></ion-icon>
              {{ editingId ? 'Editar' : 'Nuevo' }} Vehículo
            </ion-card-title>
          </ion-card-header>
          
          <ion-card-content>
            <ion-list>
              <ion-item>
                <ion-label position="floating">Placa <ion-text color="danger">*</ion-text></ion-label>
                <ion-input
                  type="text"
                  [value]="form().placa"
                  (ionInput)="$event && setPlaca($any($event).detail.value)"
                  required>
                </ion-input>
              </ion-item>
              @if (!form().placa && showFormErrors) {
                <ion-note color="danger">
                  La placa es requerida
                </ion-note>
              }

              <ion-item>
                <ion-label position="floating">Modelo <ion-text color="danger">*</ion-text></ion-label>
                <ion-input
                  type="text"
                  [value]="form().modelo"
                  (ionInput)="$event && setModelo($any($event).detail.value)"
                  required>
                </ion-input>
              </ion-item>
              @if (!form().modelo && showFormErrors) {
                <ion-note color="danger">
                  El modelo es requerido
                </ion-note>
              }

              <ion-item>
                <ion-label position="floating">Marca</ion-label>
                <ion-input
                  type="text"
                  [value]="form().marca"
                  (ionInput)="$event && setMarca($any($event).detail.value)">
                </ion-input>
              </ion-item>

              <ion-item>
                <ion-label>Activo</ion-label>
                <ion-toggle
                  [checked]="form().activo"
                  (ionChange)="setActivo($any($event).detail.checked)">
                </ion-toggle>
              </ion-item>

              <ion-row class="ion-margin-top ion-text-end">
                <ion-col>
                  <ion-button 
                    color="medium" 
                    fill="outline" 
                    (click)="resetForm()"
                    class="ion-margin-end">
                    <ion-icon slot="start" name="close-circle-outline"></ion-icon>
                    Cancelar
                  </ion-button>
                  <ion-button 
                    color="primary" 
                    [disabled]="!form().placa || !form().modelo"
                    (click)="showFormErrors = true; save()">
                    <ion-icon slot="start" name="save-outline"></ion-icon>
                    {{ editingId ? 'Actualizar' : 'Guardar' }}
                  </ion-button>
                </ion-col>
              </ion-row>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-card>
          <ion-card-header>
            <ion-card-title>
              <ion-icon name="list" class="ion-margin-end"></ion-icon>
              Lista de Vehículos
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            @if (isLoading()) {
              <ion-row justify-content-center>
                <ion-col size="12" class="ion-text-center">
                  <ion-spinner name="crescent"></ion-spinner>
                  <ion-text class="ion-margin-start">Cargando vehículos...</ion-text>
                </ion-col>
              </ion-row>
            } @else {
              <ion-list>
                  @if (vehiculos().length > 0) {
                    @for (veh of vehiculos(); track veh.id; let i = $index) {
                    <ion-item [class.item-selected]="editingId === veh.id">
                      <ion-label>
                        <ion-text>{{ veh.placa }}</ion-text>
                        <ion-row align-items-center>
                          <ion-col class="ion-no-padding" size="auto">
                            <ion-text color="medium">{{ veh.modelo }}</ion-text>
                          </ion-col>
                          <ion-col class="ion-no-padding" size="auto">
                            <ion-text color="medium"> • </ion-text>
                          </ion-col>
                          <ion-col class="ion-no-padding" size="auto">
                            <ion-badge [color]="getActivoColor(veh.activo)" class="ion-text-uppercase">
                              {{ veh.activo ? 'ACTIVO' : 'INACTIVO' }}
                            </ion-badge>
                          </ion-col>
                        </ion-row>
                        <ion-row>
                          <ion-col class="ion-no-padding">
                            <ion-text color="medium">
                              <ion-icon name="pricetag" class="ion-margin-end"></ion-icon>
                              {{ veh.marca || 'Sin marca' }}
                            </ion-text>
                          </ion-col>
                        </ion-row>
                      </ion-label>
                      <ion-buttons slot="end" class="action-buttons">
                        <ion-button fill="solid" color="primary" (click)="edit(veh)" class="action-button">
                          <ion-icon slot="start" name="create-outline"></ion-icon>
                          Editar
                        </ion-button>
                        <ion-button fill="solid" color="danger" (click)="confirmRemove(veh)" class="action-button">
                          <ion-icon slot="start" name="trash-outline"></ion-icon>
                          Eliminar
                        </ion-button>
                      </ion-buttons>
                    </ion-item>
                  }
                } @else {
                  <ion-item lines="none" class="ion-text-center">
                    <ion-label class="ion-text-wrap">
                      <ion-icon name="alert-circle" color="medium" size="large"></ion-icon>
                      <ion-text>No hay vehículos registrados</ion-text>
                      <ion-text color="medium">Utiliza el formulario superior para agregar un nuevo vehículo.</ion-text>
                    </ion-label>
                  </ion-item>
                }
              </ion-list>
            }
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>

