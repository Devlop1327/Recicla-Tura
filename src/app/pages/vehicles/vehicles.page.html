<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Gestión de Vehículos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <ion-grid class="ion-padding">
    <!-- Formulario de vehículo -->
    <ion-row>
      <ion-col size="12" size-md="8" offset-md="2" size-lg="6" offset-lg="3">
        <ion-card>
          <ion-card-header>
            <ion-card-title>
              <ion-icon name="car-outline" class="ion-margin-end"></ion-icon>
              {{ editingId ? 'Editar' : 'Nuevo' }} Vehículo
            </ion-card-title>
          </ion-card-header>
          
          <ion-card-content>
            <form (ngSubmit)="save()" #vehiculoForm="ngForm">
              <ion-item>
                <ion-label position="floating">Placa <ion-text color="danger">*</ion-text></ion-label>
                <ion-input
                  type="text"
                  [value]="form().placa"
                  (ionInput)="setPlaca($any($event).detail.value)"
                  required>
                </ion-input>
              </ion-item>
              <ion-note color="danger" *ngIf="vehiculoForm.submitted && !form().placa">
                La placa es requerida
              </ion-note>

              <ion-item>
                <ion-label position="floating">Modelo <ion-text color="danger">*</ion-text></ion-label>
                <ion-input
                  type="text"
                  [value]="form().modelo"
                  (ionInput)="setModelo($any($event).detail.value)"
                  required>
                </ion-input>
              </ion-item>
              <ion-note color="danger" *ngIf="vehiculoForm.submitted && !form().modelo">
                El modelo es requerido
              </ion-note>

              <ion-item>
                <ion-label position="floating">Color</ion-label>
                <ion-input
                  type="text"
                  [value]="form().color"
                  (ionInput)="setColor($event.detail.value)">
                </ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="floating">Capacidad (kg)</ion-label>
                <ion-input
                  type="number"
                  [value]="form().capacidad"
                  (ionInput)="setCapacidad($event.detail.value)"
                  min="0"
                  required>
                </ion-input>
              </ion-item>

              <ion-item>
                <ion-label>Estado</ion-label>
                <ion-select
                  [value]="form().estado"
                  (ionChange)="setEstado($event.detail.value)"
                  interface="action-sheet"
                  cancelText="Cancelar"
                  okText="Aceptar">
                  <ion-select-option value="activo">Activo</ion-select-option>
                  <ion-select-option value="inactivo">Inactivo</ion-select-option>
                  <ion-select-option value="mantenimiento">Mantenimiento</ion-select-option>
                </ion-select>
              </ion-item>

              <div class="ion-margin-top ion-text-end">
                <ion-button 
                  type="button"
                  color="medium" 
                  fill="outline" 
                  (click)="resetForm()"
                  class="ion-margin-end">
                  <ion-icon slot="start" name="close-circle-outline"></ion-icon>
                  Cancelar
                </ion-button>
                <ion-button 
                  type="submit"
                  color="primary" 
                  [disabled]="!form().placa || !form().modelo">
                  <ion-icon slot="start" name="save-outline"></ion-icon>
                  {{ editingId ? 'Actualizar' : 'Guardar' }}
                </ion-button>
              </div>
            </form>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-card>
          <ion-card-header>
            <ion-card-title>
              <ion-icon name="list" class="ion-margin-end"></ion-icon>
              Lista de Vehículos
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            @if (isLoading()) {
              <div>Cargando vehículos...</div>
            } @else {
              <ion-list>
                  @if (vehiculos().length > 0) {
                    @for (veh of vehiculos(); track veh.id; let i = $index) {
                    <ion-item [class.item-selected]="editingId === veh.id">
                      <ion-label>
                        <h2>{{ veh.placa }}</h2>
                        <p>
                          <ion-text color="medium">{{ veh.modelo }}</ion-text> • 
                          <ion-badge [color]="getEstadoColor(veh.estado)" class="ion-text-uppercase">
                            {{ veh.estado }}
                          </ion-badge>
                        </p>
                        <p>
                          <ion-text color="medium">
                            <small>
                              <ion-icon name="color-palette" class="ion-margin-end"></ion-icon>
                              {{ veh.color || 'Sin color' }} • 
                              <ion-icon name="speedometer" class="ion-margin-start ion-margin-end"></ion-icon>
                              {{ veh.capacidad }} kg
                            </small>
                          </ion-text>
                        </p>
                      </ion-label>
                      <ion-buttons slot="end" class="action-buttons">
                        <ion-button fill="solid" color="primary" (click)="edit(veh)" class="action-button">
                          <ion-icon slot="start" name="create-outline"></ion-icon>
                          Editar
                        </ion-button>
                        <ion-button fill="solid" color="danger" (click)="confirmRemove(veh)" class="action-button">
                          <ion-icon slot="start" name="trash-outline"></ion-icon>
                          Eliminar
                        </ion-button>
                      </ion-buttons>
                    </ion-item>
                  }
                } @else {
                  <ion-item lines="none" class="ion-text-center">
                    <ion-label class="ion-text-wrap">
                      <ion-icon name="alert-circle" color="medium" size="large"></ion-icon>
                      <h3>No hay vehículos registrados</h3>
                      <p>Utiliza el formulario superior para agregar un nuevo vehículo.</p>
                    </ion-label>
                  </ion-item>
                }
              </ion-list>
            }
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
